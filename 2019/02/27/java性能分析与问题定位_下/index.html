<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>java性能分析与问题定位_下 | try-catch的博客</title>

  
  <meta name="author" content="John Doe">
  

  
  <meta name="description" content="此文档接上一篇：java性能分析与问题定位_上

我们大概看一眼，就会发现，主要是WebAppClassLoader持有大量Activity对象的引用。

使用合并最短根路径(GC ROOTS)方式，检查对象的引用路径,如下图。


Merge Shortest Path To GC Roots：快">
  

  
  
  <meta name="keywords" content>
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="java性能分析与问题定位_下">

  <meta property="og:site_name" content="try-catch的博客">

  
  <meta property="og:image" content="/blogs/favicon.ico">
  

  <link href="/blogs/favicon.ico" rel="icon">
  <link rel="alternate" href="/blogs/atom.xml" title="try-catch的博客" type="application/atom+xml">
  <link rel="stylesheet" href="/blogs/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/blogs/">try-catch的博客</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="https://machunlin.github.io/blogs/">首页</a></li>
      
        <li><a href="/blogs/archives">目录</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>java性能分析与问题定位_下</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/blogs/2019/02/27/java性能分析与问题定位_下/" rel="bookmark">
        <time class="entry-date published" datetime="2019-02-27T05:14:39.000Z">
          2019-02-27
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>此文档接上一篇：java性能分析与问题定位_上</p>
<ul>
<li><p>我们大概看一眼，就会发现，主要是WebAppClassLoader持有大量Activity对象的引用。<br><img src="http://i1.bvimg.com/678568/25732ba0671a9b9d.png" alt="activity对象的引用者"></p>
</li>
<li><p>使用合并最短根路径(GC ROOTS)方式，检查对象的引用路径,如下图。</p>
</li>
</ul>
<p>Merge Shortest Path To GC Roots：<br>快速分析的一个常用功能，它能够从当前内存映像中找到一条指定对象所在的到GC Root的最短路径。</p>
<p>需要排除弱引用、软引用及影子引用等，一般来说这三种类型的引用都不会是造成内存泄漏的原因，<br>因为JVM迟早是会回收只存在这三种引用的资源的。<br><img src="http://i1.bvimg.com/678568/b00233136dcff57b.png" alt="gcroots"></p>
<ul>
<li>再次确认，要是WebAppClassLoader持有大量Activity对象的引用。<br>我们通过决策树的方式分析，大概可以判断Activity对象是内存泄漏的最大嫌疑人。<br><img src="http://i1.bvimg.com/678568/279444f984a6fc07.png" alt="activity"></li>
</ul>
<h2 id="3-2-直方图"><a href="#3-2-直方图" class="headerlink" title="3.2. 直方图"></a>3.2. 直方图</h2><p>下面我们再通过直方图的方式分析。</p>
<p>直方图首页，依然通过浅堆和保留堆来分析，发现FindShoppingCartByType对象可能导致内存泄漏。<br><img src="http://i1.bvimg.com/678568/c51f294ff3a1d7ec.png" alt="直方图首页"></p>
<ul>
<li><p>查看引用人是谁(with incoming references)<br><img src="http://i1.bvimg.com/678568/f47b5fd8b3b0a472.png" alt="直方图引用人"></p>
</li>
<li><p>咦，又看到熟悉的人了，Activity……<br><img src="http://i1.bvimg.com/678568/0a0565e2d34f7373.png" alt="incoming"></p>
</li>
<li><p>依然使用合并最短根路径(GC ROOTS)方式，检查对象的引用路径,如下图。<br><img src="http://i1.bvimg.com/678568/03f0ebe813b558ff.png" alt="gcroots"></p>
</li>
<li><p>根据下图，得出结论：<br>主要是WebAppClassLoader持有大量Activity对象的引用；<br>Activity对象持有大量FindShoppingCartByType对象的引用。</p>
</li>
</ul>
<p><img src="http://i1.bvimg.com/678568/ac7df0cfba6c10b0.png" alt="gcroots"></p>
<p>因为本例的程序是部署在tomcat中，这就相当于是Activity对象常驻内存，无法在GC时释放。<br>通过阅读代码，发现Activity对象是使用static声明的变量，符合我们的推断。至此，内存泄漏问题定位到了原因，后面就是改代码啦。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>

  

	<section id="comment" class="comment">
		<div id="gitment"></div>
	</section>
	<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
	<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
	<script>
		var gitment = new Gitment({
			owner: 'machunlin',
			repo: 'https://github.com/machunlin/bolgComment.git',
			oauth: {
				client_id: '',
				client_secret: '',
			},
		})
		gitment.render('gitment')
	</script>





    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    <br>
    
    &copy; 2019 John Doe
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>